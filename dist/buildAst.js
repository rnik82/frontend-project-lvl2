"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _lodash = _interopRequireDefault(require("lodash"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const buildAst = (data1, data2) => {
  const keys1 = Object.keys(data1);
  const keys2 = Object.keys(data2);

  const commonKeys = _lodash.default.uniq(keys1.concat(keys2));

  const result = commonKeys.map(key => {
    const value1 = data1[key];
    const value2 = data2[key];

    if (_lodash.default.has(data1, key) && _lodash.default.has(data2, key)) {
      if (typeof value1 === 'object' && typeof value2 === 'object') {
        return {
          status: 'unchanged',
          key,
          children: buildAst(value1, value2)
        };
      }

      if (value1 !== value2) {
        return {
          status: 'changed',
          key,
          value: value1,
          value2
        };
      }

      return {
        status: 'unchanged',
        key,
        value: value1
      };
    }

    if (_lodash.default.has(data1, key) && !_lodash.default.has(data2, key)) {
      return {
        status: 'deleted',
        key,
        value: value1
      };
    }

    if (!_lodash.default.has(data1, key) && _lodash.default.has(data2, key)) {
      return {
        status: 'added',
        key,
        value: value2
      };
    }
  });
  return _lodash.default.flatten(result);
};

var _default = buildAst;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9idWlsZEFzdC5qcyJdLCJuYW1lcyI6WyJidWlsZEFzdCIsImRhdGExIiwiZGF0YTIiLCJrZXlzMSIsIk9iamVjdCIsImtleXMiLCJrZXlzMiIsImNvbW1vbktleXMiLCJfIiwidW5pcSIsImNvbmNhdCIsInJlc3VsdCIsIm1hcCIsImtleSIsInZhbHVlMSIsInZhbHVlMiIsImhhcyIsInN0YXR1cyIsImNoaWxkcmVuIiwidmFsdWUiLCJmbGF0dGVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7QUFFQSxNQUFNQSxRQUFRLEdBQUcsQ0FBQ0MsS0FBRCxFQUFRQyxLQUFSLEtBQWtCO0FBRS9CLFFBQU1DLEtBQUssR0FBR0MsTUFBTSxDQUFDQyxJQUFQLENBQVlKLEtBQVosQ0FBZDtBQUNBLFFBQU1LLEtBQUssR0FBR0YsTUFBTSxDQUFDQyxJQUFQLENBQVlILEtBQVosQ0FBZDs7QUFFQSxRQUFNSyxVQUFVLEdBQUdDLGdCQUFFQyxJQUFGLENBQU9OLEtBQUssQ0FBQ08sTUFBTixDQUFhSixLQUFiLENBQVAsQ0FBbkI7O0FBRUEsUUFBTUssTUFBTSxHQUFHSixVQUFVLENBQUNLLEdBQVgsQ0FBZ0JDLEdBQUQsSUFBUztBQUNyQyxVQUFNQyxNQUFNLEdBQUdiLEtBQUssQ0FBQ1ksR0FBRCxDQUFwQjtBQUNBLFVBQU1FLE1BQU0sR0FBR2IsS0FBSyxDQUFDVyxHQUFELENBQXBCOztBQUNBLFFBQUlMLGdCQUFFUSxHQUFGLENBQU1mLEtBQU4sRUFBYVksR0FBYixLQUFxQkwsZ0JBQUVRLEdBQUYsQ0FBTWQsS0FBTixFQUFhVyxHQUFiLENBQXpCLEVBQTRDO0FBQzFDLFVBQUksT0FBT0MsTUFBUCxLQUFrQixRQUFsQixJQUE4QixPQUFPQyxNQUFQLEtBQWtCLFFBQXBELEVBQThEO0FBQzVELGVBQU87QUFBRUUsVUFBQUEsTUFBTSxFQUFFLFdBQVY7QUFBdUJKLFVBQUFBLEdBQXZCO0FBQTRCSyxVQUFBQSxRQUFRLEVBQUVsQixRQUFRLENBQUNjLE1BQUQsRUFBU0MsTUFBVDtBQUE5QyxTQUFQO0FBQ0Q7O0FBQ0QsVUFBSUQsTUFBTSxLQUFLQyxNQUFmLEVBQXVCO0FBQ3JCLGVBQU87QUFBRUUsVUFBQUEsTUFBTSxFQUFFLFNBQVY7QUFBcUJKLFVBQUFBLEdBQXJCO0FBQTBCTSxVQUFBQSxLQUFLLEVBQUVMLE1BQWpDO0FBQXlDQyxVQUFBQTtBQUF6QyxTQUFQO0FBQ0Q7O0FBQ0QsYUFBTztBQUFFRSxRQUFBQSxNQUFNLEVBQUUsV0FBVjtBQUF1QkosUUFBQUEsR0FBdkI7QUFBNEJNLFFBQUFBLEtBQUssRUFBRUw7QUFBbkMsT0FBUDtBQUNEOztBQUNELFFBQUlOLGdCQUFFUSxHQUFGLENBQU1mLEtBQU4sRUFBYVksR0FBYixLQUFxQixDQUFDTCxnQkFBRVEsR0FBRixDQUFNZCxLQUFOLEVBQWFXLEdBQWIsQ0FBMUIsRUFBNkM7QUFDM0MsYUFBTztBQUFFSSxRQUFBQSxNQUFNLEVBQUUsU0FBVjtBQUFxQkosUUFBQUEsR0FBckI7QUFBMEJNLFFBQUFBLEtBQUssRUFBRUw7QUFBakMsT0FBUDtBQUNEOztBQUNELFFBQUksQ0FBQ04sZ0JBQUVRLEdBQUYsQ0FBTWYsS0FBTixFQUFhWSxHQUFiLENBQUQsSUFBc0JMLGdCQUFFUSxHQUFGLENBQU1kLEtBQU4sRUFBYVcsR0FBYixDQUExQixFQUE2QztBQUMzQyxhQUFPO0FBQUVJLFFBQUFBLE1BQU0sRUFBRSxPQUFWO0FBQW1CSixRQUFBQSxHQUFuQjtBQUF3Qk0sUUFBQUEsS0FBSyxFQUFFSjtBQUEvQixPQUFQO0FBQ0M7QUFDRixHQWxCWSxDQUFmO0FBbUJBLFNBQU9QLGdCQUFFWSxPQUFGLENBQVVULE1BQVYsQ0FBUDtBQUNELENBM0JIOztlQTZCaUJYLFEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5jb25zdCBidWlsZEFzdCA9IChkYXRhMSwgZGF0YTIpID0+IHtcblxuICAgIGNvbnN0IGtleXMxID0gT2JqZWN0LmtleXMoZGF0YTEpO1xuICAgIGNvbnN0IGtleXMyID0gT2JqZWN0LmtleXMoZGF0YTIpO1xuICBcbiAgICBjb25zdCBjb21tb25LZXlzID0gXy51bmlxKGtleXMxLmNvbmNhdChrZXlzMikpO1xuICBcbiAgICBjb25zdCByZXN1bHQgPSBjb21tb25LZXlzLm1hcCgoa2V5KSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZTEgPSBkYXRhMVtrZXldO1xuICAgICAgY29uc3QgdmFsdWUyID0gZGF0YTJba2V5XTtcbiAgICAgIGlmIChfLmhhcyhkYXRhMSwga2V5KSAmJiBfLmhhcyhkYXRhMiwga2V5KSkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlMSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHZhbHVlMiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICByZXR1cm4geyBzdGF0dXM6ICd1bmNoYW5nZWQnLCBrZXksIGNoaWxkcmVuOiBidWlsZEFzdCh2YWx1ZTEsIHZhbHVlMil9O1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZTEgIT09IHZhbHVlMikge1xuICAgICAgICAgIHJldHVybiB7IHN0YXR1czogJ2NoYW5nZWQnLCBrZXksIHZhbHVlOiB2YWx1ZTEsIHZhbHVlMiB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHN0YXR1czogJ3VuY2hhbmdlZCcsIGtleSwgdmFsdWU6IHZhbHVlMX07XG4gICAgICB9XG4gICAgICBpZiAoXy5oYXMoZGF0YTEsIGtleSkgJiYgIV8uaGFzKGRhdGEyLCBrZXkpKSB7XG4gICAgICAgIHJldHVybiB7IHN0YXR1czogJ2RlbGV0ZWQnLCBrZXksIHZhbHVlOiB2YWx1ZTF9O1xuICAgICAgfVxuICAgICAgaWYgKCFfLmhhcyhkYXRhMSwga2V5KSAmJiBfLmhhcyhkYXRhMiwga2V5KSkge1xuICAgICAgICByZXR1cm4geyBzdGF0dXM6ICdhZGRlZCcsIGtleSwgdmFsdWU6IHZhbHVlMiB9O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICByZXR1cm4gXy5mbGF0dGVuKHJlc3VsdCk7XG4gIH07XG5cbiAgZXhwb3J0IGRlZmF1bHQgYnVpbGRBc3Q7XG4gICJdfQ==